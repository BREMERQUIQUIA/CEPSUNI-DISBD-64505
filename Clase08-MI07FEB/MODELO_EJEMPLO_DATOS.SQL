-- CLIENTES

SELECT * FROM CLIENTE;
GO

INSERT INTO CLIENTE VALUES('GUSTAVO','LIMA','947623679');
INSERT INTO CLIENTE VALUES('ERICSON','LIMA','947000679');
INSERT INTO CLIENTE VALUES('SEBASTIAN','LIMA','947145726');
INSERT INTO CLIENTE VALUES('RICARDO','LIMA','992705567');
INSERT INTO CLIENTE VALUES('SABINA','LIMA','992705567');
INSERT INTO CLIENTE VALUES('ALDO','LIMA','985432354');
INSERT INTO CLIENTE VALUES('ARTURO','LIMA','943559665');
GO


-- PRODUCTOS

SELECT * FROM PRODUCTO;
GO

INSERT INTO PRODUCTO VALUES('LAPTOP',3500.0,50);
INSERT INTO PRODUCTO VALUES('TELEVISOR',2400.0,150);
INSERT INTO PRODUCTO VALUES('CELULAR',1800.0,25);
INSERT INTO PRODUCTO VALUES('LAVADORA',1600.0,40);
INSERT INTO PRODUCTO VALUES ('TABLET', 1500.0, 30);
GO


-- VENTAS

SELECT * FROM VENTA;
GO

INSERT INTO VENTA VALUES(1,'20240110',0);
INSERT INTO VENTA VALUES(2,'20240224',0);
INSERT INTO VENTA VALUES(3,'20240119',0);
INSERT INTO VENTA VALUES(4,'20240205',0);
INSERT INTO VENTA VALUES(1,'20231201',0);
INSERT INTO VENTA VALUES(6,'20240213',0);
INSERT INTO VENTA VALUES(5,'20240228',0);
GO

-- DETALLE

SELECT * FROM ITEMS;
GO

-- VENTA 1
INSERT INTO ITEMS VALUES(2,1,3,0,0);
INSERT INTO ITEMS VALUES(4,1,2,0,0);
INSERT INTO ITEMS VALUES(5,1,4,0,0);
GO

-- VENTA 2
INSERT INTO ITEMS VALUES(2,2,160,0,0);INSERT INTO ITEMS VALUES(1,2,20,0,0);INSERT INTO ITEMS VALUES(3,2,40,0,0);INSERT INTO ITEMS VALUES(5,2,8,0,0);
GO


-- VENTA 3
INSERT INTO ITEMS VALUES(2,3,4,0,0);INSERT INTO ITEMS VALUES(5,3,6,0,0);INSERT INTO ITEMS VALUES(1,3,5,0,0);
GO


-- ACTUALIZAR PRECIO DE ITEMS

UPDATE ITEMS
SET PRECIO = P.PRECIO
FROM PRODUCTO P 
JOIN ITEMS I ON P.IDPRODUCTO = I.IDPRODUCTO;
GO

SELECT * FROM ITEMS;
GO


-- ACTUALIZAR EL SUBTOTAL EN ITEMS

SELECT * FROM ITEMS;
GO

UPDATE ITEMS 
SET SUBTOTAL = CANTIDAD * PRECIO;
GO


-- ACTUALIZAR EL TOTAL EN VENTA

DECLARE @VENTA INT;
SET @VENTA=4;
SELECT * FROM VENTA WHERE IDVENTA = @VENTA;
SELECT * FROM ITEMS WHERE IDVENTA = @VENTA;
GO

UPDATE VENTA 
SET TOTAL = ISNULL((SELECT SUM(SUBTOTAL) FROM ITEMS I WHERE I.IDVENTA=V.IDVENTA),0)
FROM VENTA V;
GO





